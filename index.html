<script>
  // üîê ADMIN
  const params = new URLSearchParams(window.location.search);
  const isAdmin = params.get("admin") === "1234";

  // üî¥ Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDRxhtq9epAkPkTaT5f9TD4rSZAUCfX6oc",
    authDomain: "desafio-depositos-852a3.firebaseapp.com",
    databaseURL: "https://desafio-depositos-852a3-default-rtdb.firebaseio.com",
    projectId: "desafio-depositos-852a3",
    storageBucket: "desafio-depositos-852a3.firebasestorage.app",
    messagingSenderId: "647027057762",
    appId: "1:647027057762:web:28a08bbd69362290ecdd3b"
  };

  firebase.initializeApp(firebaseConfig);

  // ‚úÖ AGORA SIM
  const db = firebase.database();
  const refChecks = db.ref("desafio/checks");
  const refHistorico = db.ref("desafio/historico");

  const TOTAL = 200;
  const META = 20100;
  let checks = {};

  document.getElementById("modo").textContent =
    isAdmin ? "üîì Modo Administrador" : "üëÄ Modo Visualiza√ß√£o";

  function calcularResumo() {
    let soma = 0;
    let qtd = 0;

    for (let i = 1; i <= TOTAL; i++) {
      if (checks[i]) {
        soma += i;
        qtd++;
      }
    }

    const perc = Math.min((soma / META) * 100, 100);

    document.getElementById("total").textContent = soma;
    document.getElementById("qtd").textContent = qtd;
    document.getElementById("barra").style.width = perc + "%";
    document.getElementById("percentual").textContent =
      perc.toFixed(1) + "%";
  }

  function render() {
    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    for (let i = 1; i <= TOTAL; i++) {
      const div = document.createElement("div");
      div.className = "item";
      div.textContent = `R$ ${i}`;

      if (checks[i]) div.classList.add("checked");
      if (!isAdmin) div.classList.add("readonly");

      div.onclick = () => {
        if (!isAdmin) return;

        const acao = checks[i] ? "desfazer" : "confirmar";
        const ok = confirm(`Deseja ${acao} o dep√≥sito de R$ ${i}?`);
        if (!ok) return;

        if (!checks[i]) {
          const agora = new Date();
          const data =
            agora.toLocaleDateString("pt-BR") +
            " " +
            agora.toLocaleTimeString("pt-BR", {
              hour: "2-digit",
              minute: "2-digit"
            });

          refHistorico.push({
            valor: i,
            data: data
          });
        }

        checks[i] = !checks[i];
        refChecks.set(checks);
      };

      grid.appendChild(div);
    }

    calcularResumo();
  }

  function renderHistorico(dados) {
    const div = document.getElementById("historico");
    div.innerHTML = "";

    const lista = Object.values(dados).reverse();

    if (lista.length === 0) {
      div.innerHTML = "<em>Nenhum dep√≥sito registrado.</em>";
      return;
    }

    lista.forEach(item => {
      const linha = document.createElement("div");
      linha.textContent = `‚úî R$ ${item.valor} ‚Äî ${item.data}`;
      div.appendChild(linha);
    });
  }

  refChecks.on("value", snapshot => {
    checks = snapshot.val() || {};
    render();
  });

  refHistorico.on("value", snapshot => {
    renderHistorico(snapshot.val() || {});
  });
</script>




